<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Chave Gemini</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white p-8 rounded-xl shadow-lg max-w-lg w-full">
        <h1 class="text-2xl font-bold text-gray-800 mb-2"><i class="fa-solid fa-stethoscope text-blue-600"></i> Diagnóstico de Chave</h1>
        <p class="text-gray-600 mb-6 text-sm">Descubra quais modelos sua chave pode acessar.</p>

        <label class="block font-bold text-gray-700 mb-2">Cole sua Chave API:</label>
        <input type="text" id="api-key" class="w-full p-3 border border-gray-300 rounded-lg font-mono text-sm mb-4 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="AIzaSy...">

        <button id="check-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg transition">
            Testar Minha Chave Agora
        </button>

        <!-- RESULTADOS -->
        <div id="result-area" class="mt-6 hidden">
            <div id="loading" class="text-center text-gray-500 hidden">
                <i class="fa-solid fa-spinner fa-spin mr-2"></i> Consultando Google...
            </div>

            <div id="success-box" class="hidden bg-green-50 border border-green-200 p-4 rounded-lg">
                <h3 class="font-bold text-green-800 mb-2"><i class="fa-solid fa-check-circle"></i> Sucesso! Chave Válida.</h3>
                <p class="text-sm text-green-700 mb-2">Modelos disponíveis para você:</p>
                <ul id="model-list" class="list-disc list-inside text-xs font-mono text-green-900 bg-green-100 p-2 rounded"></ul>
                <p class="text-xs text-gray-500 mt-2">Recomendado para o site: <b>gemini-1.5-flash</b></p>
            </div>

            <div id="error-box" class="hidden bg-red-50 border border-red-200 p-4 rounded-lg">
                <h3 class="font-bold text-red-800 mb-2"><i class="fa-solid fa-triangle-exclamation"></i> Chave Inválida</h3>
                <p class="text-sm text-red-700 mb-2">O Google recusou a conexão:</p>
                <code id="error-msg" class="block bg-red-100 p-2 rounded text-xs font-mono text-red-900 break-all"></code>
                <div class="mt-3 text-sm text-red-800">
                    <strong>Soluções prováveis:</strong>
                    <ul class="list-disc list-inside mt-1">
                        <li>A chave tem espaços extras (copie com cuidado).</li>
                        <li>A chave tem "Restrições de Site" ativadas (mude para "None").</li>
                        <li>Sua conta escolar bloqueou o uso da IA (teste com Gmail pessoal).</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('check-btn').addEventListener('click', async () => {
            const apiKey = document.getElementById('api-key').value.trim();
            const resultArea = document.getElementById('result-area');
            const loading = document.getElementById('loading');
            const successBox = document.getElementById('success-box');
            const errorBox = document.getElementById('error-box');
            const modelList = document.getElementById('model-list');
            const errorMsg = document.getElementById('error-msg');

            // Reset UI
            resultArea.classList.remove('hidden');
            loading.classList.remove('hidden');
            successBox.classList.add('hidden');
            errorBox.classList.add('hidden');

            if (!apiKey) {
                loading.classList.add('hidden');
                alert("Por favor, cole a chave primeiro.");
                return;
            }

            try {
                // Tenta listar os modelos. Se a chave for ruim, isso falha aqui.
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);
                const data = await response.json();

                loading.classList.add('hidden');

                if (response.ok && data.models) {
                    // SUCESSO
                    successBox.classList.remove('hidden');
                    modelList.innerHTML = '';
                    
                    // Filtra apenas modelos "generateContent" (que geram texto)
                    const usefulModels = data.models
                        .filter(m => m.supportedGenerationMethods && m.supportedGenerationMethods.includes("generateContent"))
                        .map(m => m.name.replace('models/', ''));

                    if (usefulModels.length === 0) {
                        modelList.innerHTML = "<li>Nenhum modelo de texto encontrado nesta conta.</li>";
                    } else {
                        usefulModels.forEach(model => {
                            const li = document.createElement('li');
                            li.textContent = model;
                            // Destaca o modelo que queremos
                            if (model === 'gemini-1.5-flash') {
                                li.className = "font-bold text-green-700 bg-green-200 px-1 rounded";
                                li.innerHTML += " (Ideal)";
                            }
                            modelList.appendChild(li);
                        });
                    }
                } else {
                    // ERRO DO GOOGLE (400, 403, 404)
                    throw new Error(data.error ? data.error.message : "Erro desconhecido na resposta.");
                }

            } catch (error) {
                loading.classList.add('hidden');
                errorBox.classList.remove('hidden');
                errorMsg.textContent = error.message;
            }
        });
    </script>
</body>
</html>
